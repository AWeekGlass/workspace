<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hengyu.cases.dao.CaseDAO">
	<!-- 根据案例分类查询列表 -->
	<select id="queryCaseInfoByCate" resultType="CaseInfoVo">
		select c.id companyId,c.`name`,c.category,cat.category
		categoryName,c.create_time From
		jyq_case c
		left join
		jyq_category cat
		on
		c.category = cat.id 
		<where>
			<if test="category != null and category != ''">
				and c.category = #{category}
			</if>
			<if test="companyId != null and companyId != ''">
				and c.company_id = #{companyId}
			</if>
		</where>
		order by c.create_time asc
	</select>

	<!-- 根据ID查询案例详情 -->
	<select id="queryCaseInfoById" resultType="CaseInfoVo">
		select * From (
		select
		a.user_name,cat.category categoryName,c.create_admin
		adminId,c.`name`,c.step1,c.step2,c.step3,c.step4,c.create_time,c.type,com.company_name,d.name
		as deptName,r.name as roleName From jyq_case c
		LEFT JOIN
		jyq_company com
		on
		c.company_id = com.id
		LEFT JOIN
		jyq_admin a
		on
		c.create_admin = a.id
		LEFT JOIN
		jyq_dept d
		ON
		a.dept_id = d.id
		LEFT JOIN
		sys_role r
		on a.role_id =
		r.id
		LEFT JOIN
		jyq_category cat
		on c.category = cat.id
		where c.id =
		#{caseId}
		) as t
	</select>

</mapper>
