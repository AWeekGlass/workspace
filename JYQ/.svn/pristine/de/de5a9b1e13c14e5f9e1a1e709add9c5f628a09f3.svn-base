package com.hengyu.cases.web;

import static com.hengyu.common.constant.CommonConstants.ADD_FAILURE;
import static com.hengyu.common.constant.CommonConstants.ADD_SUCCESS;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.hengyu.cases.entity.Category;
import com.hengyu.cases.service.CategoryService;
import com.hengyu.cases.vo.CategoryVo;
import com.hengyu.common.jwt.IJWTInfo;
import com.hengyu.common.msg.RestResponse;
import com.hengyu.common.util.JWTUtils;

import io.swagger.annotations.Api;
import io.swagger.annotations.ApiImplicitParam;
import io.swagger.annotations.ApiOperation;

/**
 * <p>
 * 
 * </p>
 * 
 * @author hongyuan
 * @since 2018年9月6日
 * @version
 *
 */
@RestController
@RequestMapping("/category")
@Api(value = "CategoryController", tags = "案例分类Controller")
public class CategoryController {
	@Autowired
	private CategoryService categoryService;

	@Autowired
	private JWTUtils jwtUtils;

	@ApiOperation(value = "查询案例分类", notes = "查询案例分类")
	@GetMapping("queryAll")
	public RestResponse<List<CategoryVo>> queryAll(@RequestHeader("token") String token) throws Exception {
		IJWTInfo info = jwtUtils.getInfoFromToken(token);
		return new RestResponse<List<CategoryVo>>().rel(true)
				.data(categoryService.queryAllByCompanyId(info.getCompanyId()));
	}

	@ApiOperation(value = "新增案例分类", notes = "新增案例分类")
	@ApiImplicitParam(name = "Category", value = "案例分类对象", dataTypeClass = Category.class)
	@PostMapping("add")
	public RestResponse<String> add(@RequestHeader("token") String token, @RequestBody Category category)
			throws Exception {
		IJWTInfo info = jwtUtils.getInfoFromToken(token);
		category.setCompanyId(info.getCompanyId());
		boolean flag = categoryService.insert(category);
		RestResponse<String> response = new RestResponse<String>().rel(flag);
		if (flag) {
			return response.data(ADD_SUCCESS);
		} else {
			return response.message(ADD_FAILURE);
		}
	}

}
