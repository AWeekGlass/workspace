<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hengyu.training.dao.TrainingExperienceDAO">

	<!-- 根据案例分类查询列表 -->
	<select id="queryAllByCategoryId" resultType="TrainingExperience">	
		SELECT
			t1.*, t2.user_name userName,
			t3.user_name refName
		FROM
			`jyq_training_experience` t1
		LEFT JOIN jyq_admin t2 ON t1.user_id = t2.id
		LEFT JOIN jyq_admin t3 ON t1.ref_id = t3.id
		<where>
			<if test="categoryId != null and categoryId != ''">
				AND case_category = #{categoryId}
			</if>
			<if test="companyId != null and companyId != ''">
				AND t1.company_id = #{companyId}
			</if>
			and t1.state = 1
		</where>
		ORDER BY
			t1.top_time DESC,
			t1.create_time DESC
	</select>
	
	<select id="queryDraft" resultType="TrainingExperience">
		SELECT
			t1.*, t2.user_name userName,
			t3.user_name refName
		FROM
			`jyq_training_experience` t1
		LEFT JOIN jyq_admin t2 ON t1.user_id = t2.id
		LEFT JOIN jyq_admin t3 ON t1.ref_id = t3.id
		<where>
			t1.state = 0
			<if test="companyId != null and companyId != ''">
				AND t1.company_id = #{companyId}
			</if>
		</where>
		ORDER BY t1.create_time DESC
	</select>
	
	<select id="detail" resultType="TrainingExperience">
		SELECT
			t1.*, t2.user_name userName,
			t3.user_name refName
		FROM
			`jyq_training_experience` t1
		LEFT JOIN jyq_admin t2 ON t1.user_id = t2.id
		LEFT JOIN jyq_admin t3 ON t1.ref_id = t3.id
		where t1.id = #{id}
	</select>

</mapper>
