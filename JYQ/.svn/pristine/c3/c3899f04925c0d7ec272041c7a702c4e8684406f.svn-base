package com.hengyu.system.service.impl;

import java.text.DecimalFormat;
import java.util.Date;
import java.util.List;
import java.util.Objects;

import org.apache.commons.lang3.time.FastDateFormat;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.baomidou.mybatisplus.mapper.EntityWrapper;
import com.baomidou.mybatisplus.plugins.Page;
import com.baomidou.mybatisplus.service.impl.ServiceImpl;
import com.hengyu.system.dao.OrderDAO;
import com.hengyu.system.entity.Order;
import com.hengyu.system.service.OrderService;

/**
 * <p>
 * 订单表 服务实现类
 * </p>
 *
 * @author allnas
 * @since 2018-12-05
 */
@Service
public class OrderServiceImpl extends ServiceImpl<OrderDAO, Order> implements OrderService {

	@Autowired
	private OrderDAO orderDAO;
	
	@Override
	public String createOrder(Order order) {
		order.setOrderCode(randomOrderNum(order.getCompanyId()));
		order.setPayPrice(order.getPayPrice()*100);
		boolean flag = insert(order);
		if(flag){
			return "创建成功";
		}
		return "创建失败";
	}
	
	@Override
	public Order queryDetail(Order order) {
		List<Order> list = selectList(new EntityWrapper<Order>(order));
		if(Objects.nonNull(list) && Objects.nonNull(list.get(0))){
			return list.get(0);
		}
		return null;
	}

	@Override
	public Page<Order> queryList(Order order) {
		return null;
	}
	
	/**
	 * 生成订单号
	 * @return
	 */
	private String randomOrderNum(Integer companyId){
		//查询系统中最大编号
		Integer count = orderDAO.queryMaxNum(companyId);
		DecimalFormat num = new DecimalFormat("000000");
		String code = num.format(count++);
		return FastDateFormat.getInstance("yyyyMMddHHmmss").format(new Date())+code;
	}



}
