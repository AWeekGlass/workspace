package com.hengyu.training.service.impl;

import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.baomidou.mybatisplus.service.impl.ServiceImpl;
import com.hengyu.training.dao.TrainCommentDAO;
import com.hengyu.training.entity.TrainComment;
import com.hengyu.training.service.TrainCommentService;

/**
 * <p>
 * 培训心得回复表 服务实现类
 * </p>
 *
 * @author allnas
 * @since 2018-12-14
 */
@Service
public class TrainCommentServiceImpl extends ServiceImpl<TrainCommentDAO, TrainComment> implements TrainCommentService {

	@Autowired
	private TrainCommentDAO trainComDAO;
	
	@Override
	public List<TrainComment> getCommentTree(Integer companyId, Integer id) {
		//查询父节点评论
		TrainComment trainComment = new TrainComment();
		trainComment.setCompanyId(companyId);
		trainComment.setTrainingExpId(id);
		trainComment.setType(1);
		List<TrainComment> list = trainComDAO.getTree(companyId, id, null);
		//查询子节点
		for (TrainComment trainComment_ : list) {
			List<TrainComment> trainComments = getChouBiList(companyId,trainComment_.getId());
			trainComment_.setComments(trainComments);
		}
		return list;
	}
	
	//获取子评论
	private List<TrainComment> getSonList(Integer companyId,Integer id){
		List<TrainComment> list = new ArrayList<TrainComment>();
		list = trainComDAO.getTree(companyId, null, id);
		if(Objects.nonNull(list)){
			for (TrainComment trainComment : list) {
				List<TrainComment> trainComments = getSonList(companyId, trainComment.getId());
				//嵌套
				trainComment.setComments(trainComments);
				//查询全部
				list.addAll(trainComments);
			}
		}
		return list;
	}
	
	private List<TrainComment> getChouBiList(Integer companyId,Integer id){
		List<TrainComment> list = trainComDAO.getChouBiList(companyId,id);
		return list;
	}

}
